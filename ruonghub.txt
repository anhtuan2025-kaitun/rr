--====================================================--
-- üåÄ TuanxAura Chest Finder v5 - Blue Edition
-- üíé Auto Chest by Nguy·ªÖn Anh Tu·∫•n
--====================================================--

if getgenv().TuanxAura_Chest_v5_Ran then return end
getgenv().TuanxAura_Chest_v5_Ran = true

-- SETTINGS
local SETTINGS = {
    ScanInterval = 1.0,         -- gi√¢y gi·ªØa c√°c l·∫ßn qu√©t r∆∞∆°ng
    HopTimeout = 30,            -- sau 30s kh√¥ng c√≥ r∆∞∆°ng th√¨ hop
    FlySpeed = 200,             -- t·ªëc ƒë·ªô bay tween (stud/s)
    NeonColor = Color3.fromRGB(0,170,255), -- m√†u xanh d∆∞∆°ng neon
    SaveStatsFile = "TuanxAura_Stats.json"
}

-- SERVICES
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

-- LOAD STATS
local STATS = { TotalPicked = 0 }
pcall(function()
    if isfile and isfile(SETTINGS.SaveStatsFile) then
        local raw = readfile(SETTINGS.SaveStatsFile)
        local ok, data = pcall(function() return HttpService:JSONDecode(raw) end)
        if ok and data.TotalPicked then STATS = data end
    end
end)

local function SaveStats()
    pcall(function()
        if writefile then
            writefile(SETTINGS.SaveStatsFile, HttpService:JSONEncode(STATS))
        end
    end)
end

-- ANTI AFK
pcall(function()
    local vu = game:GetService("VirtualUser")
    player.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0,0), Workspace.CurrentCamera.CFrame)
        task.wait(1)
        vu:Button2Up(Vector2.new(0,0), Workspace.CurrentCamera.CFrame)
    end)
end)

-- CREATE UI
local CoreGui = game:GetService("CoreGui")
if CoreGui:FindFirstChild("TuanxAuraUI") then CoreGui.TuanxAuraUI:Destroy() end

local ui = Instance.new("ScreenGui", CoreGui)
ui.Name = "TuanxAuraUI"
ui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local frame = Instance.new("Frame", ui)
frame.AnchorPoint = Vector2.new(0.5,0.5)
frame.Position = UDim2.new(0.5,0,0.5,0)
frame.Size = UDim2.new(0,340,0,200)
frame.BackgroundColor3 = Color3.fromRGB(10,10,15)
frame.BackgroundTransparency = 0.15
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,15)

local glow = Instance.new("UIStroke", frame)
glow.Color = SETTINGS.NeonColor
glow.Thickness = 2.2

local title = Instance.new("TextLabel", frame)
title.BackgroundTransparency = 1
title.Size = UDim2.new(1,0,0,40)
title.Font = Enum.Font.SourceSansBold
title.TextColor3 = SETTINGS.NeonColor
title.Text = "üíé TuanxAura Chest Finder v5"
title.TextSize = 20

local status = Instance.new("TextLabel", frame)
status.BackgroundTransparency = 1
status.Position = UDim2.new(0,0,0.35,0)
status.Size = UDim2.new(1,0,0,25)
status.Font = Enum.Font.SourceSansBold
status.TextColor3 = Color3.fromRGB(255,255,255)
status.Text = "‚è≥ ƒêang kh·ªüi ƒë·ªông..."
status.TextSize = 18

local timeLabel = Instance.new("TextLabel", frame)
timeLabel.BackgroundTransparency = 1
timeLabel.Position = UDim2.new(0,0,0.55,0)
timeLabel.Size = UDim2.new(1,0,0,20)
timeLabel.Font = Enum.Font.SourceSans
timeLabel.TextColor3 = Color3.fromRGB(180,180,180)
timeLabel.Text = "‚è± Th·ªùi gian: 00:00"
timeLabel.TextSize = 14

local totalLabel = Instance.new("TextLabel", frame)
totalLabel.BackgroundTransparency = 1
totalLabel.Position = UDim2.new(0,0,0.7,0)
totalLabel.Size = UDim2.new(1,0,0,20)
totalLabel.Font = Enum.Font.SourceSans
totalLabel.TextColor3 = Color3.fromRGB(180,180,255)
totalLabel.Text = "üì¶ R∆∞∆°ng ƒë√£ nh·∫∑t: "..STATS.TotalPicked
totalLabel.TextSize = 14

local watermark = Instance.new("TextLabel", frame)
watermark.BackgroundTransparency = 1
watermark.AnchorPoint = Vector2.new(1,1)
watermark.Position = UDim2.new(1,-5,1,-5)
watermark.Size = UDim2.new(0,200,0,20)
watermark.Font = Enum.Font.SourceSansSemibold
watermark.TextColor3 = SETTINGS.NeonColor
watermark.TextXAlignment = Enum.TextXAlignment.Right
watermark.Text = "Auto Chest by Nguy·ªÖn Anh Tu·∫•n"
watermark.TextSize = 13

local toggleButton = Instance.new("TextButton", ui)
toggleButton.AnchorPoint = Vector2.new(0.5,1)
toggleButton.Position = UDim2.new(0.5,0,1,-25)
toggleButton.Size = UDim2.new(0,100,0,35)
toggleButton.BackgroundColor3 = SETTINGS.NeonColor
toggleButton.TextColor3 = Color3.fromRGB(0,0,0)
toggleButton.Text = "T·∫Øt UI"
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 16
Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(1,0)

local uiVisible = true
toggleButton.MouseButton1Click:Connect(function()
	uiVisible = not uiVisible
	frame.Visible = uiVisible
	toggleButton.Text = uiVisible and "T·∫Øt UI" or "M·ªü UI"
end)

-- UTIL
local startTick = tick()
local function updateTime()
    local t = math.floor(tick() - startTick)
    local m = math.floor(t/60)
    local s = t % 60
    timeLabel.Text = string.format("‚è± Th·ªùi gian: %02d:%02d", m, s)
end

RunService.Heartbeat:Connect(updateTime)

local function getHRP()
    local c = player.Character
    return c and c:FindFirstChild("HumanoidRootPart") or nil
end

-- FIND CHEST
local function findNearestChest()
    local hrp = getHRP()
    if not hrp then return nil end
    local nearest, dist = nil, 9e9
    for _,obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Chest") or obj.Name:lower():find("chest") then
            local p = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChild("Chest") or obj:FindFirstChild("Handle")
            if p and (p.Position - hrp.Position).Magnitude < dist then
                dist = (p.Position - hrp.Position).Magnitude
                nearest = obj
            end
        end
    end
    return nearest, dist
end

-- TWEEN TO CHEST
local function tweenTo(targetPos)
    local hrp = getHRP()
    if not hrp then return end
    local distance = (targetPos - hrp.Position).Magnitude
    local t = math.clamp(distance / SETTINGS.FlySpeed, 0.3, 10)
    local tween = TweenService:Create(hrp, TweenInfo.new(t, Enum.EasingStyle.Linear), {CFrame = CFrame.new(targetPos)})
    tween:Play()
    tween.Completed:Wait()
end

-- MAIN LOOP
task.spawn(function()
    local lastFound = tick()
    while task.wait(SETTINGS.ScanInterval) do
        local chest, dist = findNearestChest()
        if chest and dist then
            status.Text = "üí∞ Ph√°t hi·ªán r∆∞∆°ng ("..math.floor(dist).."m)"
            lastFound = tick()
            local p = chest:FindFirstChild("Chest") or chest:FindFirstChild("Handle") or chest:FindFirstChildOfClass("Part")
            if p then
                tweenTo(p.Position + Vector3.new(0,3,0))
                task.wait(0.5)
                STATS.TotalPicked += 1
                SaveStats()
                totalLabel.Text = "üì¶ R∆∞∆°ng ƒë√£ nh·∫∑t: "..STATS.TotalPicked
                status.Text = "‚úÖ ƒê√£ nh·∫∑t r∆∞∆°ng #" .. STATS.TotalPicked
            end
        else
            if tick() - lastFound >= SETTINGS.HopTimeout then
                status.Text = "üåÄ Kh√¥ng th·∫•y r∆∞∆°ng - chuy·ªÉn server..."
                task.wait(2)
                local PlaceId = game.PlaceId
                local servers = {}
                local cursor = ""
                pcall(function()
                    local raw = game:HttpGet("https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Asc&limit=100")
                    local data = HttpService:JSONDecode(raw)
                    servers = data.data
                end)
                for _,srv in pairs(servers) do
                    if srv.id ~= game.JobId and srv.playing < srv.maxPlayers then
                        TeleportService:TeleportToPlaceInstance(PlaceId, srv.id, player)
                        break
                    end
                end
            else
                status.Text = "üîç ƒêang qu√©t r∆∞∆°ng..."
            end
        end
    end
end)

-- AUTO RESPAWN
player.CharacterAdded:Connect(function(char)
    task.wait(1)
    status.Text = "‚ôªÔ∏è ƒêang h·ªìi sinh..."
end)

NotifyViet = function(txt)
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "TuanxAura Chest Finder",
            Text = txt,
            Duration = 3
        })
    end)
end

NotifyViet("üöÄ ƒê√£ kh·ªüi ƒë·ªông Auto Chest v5 Blue Edition th√†nh c√¥ng!")